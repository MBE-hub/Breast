//Analysis Type - Classification 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double Over1cc_4_MLP_22_9_2_input_hidden_weights[9][22]=
{
 {3.65033377416443e+000, 1.59430393265633e+001, -1.05030062286989e+001, 4.21734304166403e+000, -4.68083639438214e+000, 9.30611223465881e+000, 3.79508727493046e+000, -4.07737361733560e+000, 6.06659791387799e-001, 9.27340926427067e-001, -5.80764295781940e+000, 5.62048589584071e-002, -1.67145115892383e+000, 4.47280649415916e+000, -2.82674825846283e+000, -6.06296585760754e+000, -3.32165736807722e+000, 7.72362235236569e+000, -2.05247845132512e+000, 5.31015549587816e+000, -4.73382601112002e+000, -2.06027906220927e+001 },
 {7.86632651174159e+000, 2.00348946192067e+001, -1.60273851181767e+001, 6.48937909964293e+000, -2.44195388461609e+000, 8.61925096150718e+000, 6.04389327248632e+000, -9.04827956583648e+000, -8.72433031713366e-001, 2.68996166208922e-002, -8.77573031948963e+000, 3.48874299583299e+000, 1.29788768108940e+000, 6.11742480976279e+000, -6.08962003969990e+000, -1.03078228332025e+001, 1.75122462050887e+000, 1.11532740440662e+001, 2.00248093686426e+000, 9.51560898430642e+000, -5.51952771632899e+000, -2.35842676482200e+001 },
 {6.68893372677234e+000, 1.65784747979846e+001, -1.47639560876507e+001, 4.56553755678688e+000, -2.51349356118052e+000, 9.34476847699485e+000, -2.48832612100666e+000, -9.52298736845023e+000, 1.37636136130609e+000, -2.69761070654306e+000, -8.97179972498891e+000, -1.69984632333490e-001, 8.71368859658149e-002, -1.93824543750678e-001, -6.05544090953671e+000, -1.23028633870780e+001, 1.00704470154787e+000, 8.79556123607329e+000, 1.78890863630958e+000, 6.67517363932654e+000, -5.37480221610663e+000, -1.73055097517403e+001 },
 {8.02204100522775e+000, 2.05153733954219e+001, -1.87548513764561e+001, 7.04977337637699e+000, -2.25994706530518e+000, 7.54383779284067e+000, 6.41511199708737e+000, -1.08240907817045e+001, -2.26844804572805e+000, -1.38846324959573e+000, -1.12491822144984e+001, 3.81088562705902e+000, 1.25625614687815e+000, 6.54537144320544e+000, -8.33826325785435e+000, -1.26719623126843e+001, 3.26676449665944e+000, 1.16239344064750e+001, 2.34513662808872e+000, 1.10719354957890e+001, -5.60388548626804e+000, -2.47348488853769e+001 },
 {-1.18678588930310e+001, 1.44881382750773e+001, 4.17200784556620e+000, 2.14502925410284e+001, -3.65990317181218e+000, 5.42773913785292e+000, 1.07441154805156e+001, 1.81473363356521e+000, -3.16109626765853e+000, 4.30939828227599e+000, -5.85726201055508e+000, -8.54975966288571e-001, -7.16951439730251e+000, 8.62586189213877e-001, -3.45815988997766e+000, -4.05041235360398e+000, -1.33714054759579e-001, 4.50965577865710e+000, -1.01209850081943e+001, 8.35778159983623e+000, -6.46994036796641e+000, -1.54014959978734e+001 },
 {-1.38156383548267e+000, 1.43513750967948e+001, -2.92002890724878e+001, -1.60342922507113e+001, -6.44609910295174e+000, 5.12369023150509e+000, -6.17446676130135e+000, -8.71553525547893e+000, 6.14906178550622e-001, 4.31984266672139e+000, -1.31353288691460e+001, -7.68802128838072e+000, 2.61938176668584e+000, 1.93688936359946e+001, -9.41133085661220e+000, -3.64420019736090e+000, 1.01993652741785e+001, 2.54230585690353e+001, 1.36119213531914e+001, 7.77151719239341e+000, 2.39996469257253e+001, -2.15387056667628e+001 },
 {5.52008025824088e+000, 1.89736838271429e+001, -1.45395768410588e+001, 6.34319299581812e+000, -4.65729460400046e+000, 9.38263974876195e+000, 4.63067385811529e+000, -8.03119610291393e+000, -5.95759161979306e-001, -1.22613075086951e-001, -9.54013772000279e+000, 1.76622739132829e+000, 5.06838438391997e-002, 4.61204928018054e+000, -4.68206999408639e+000, -1.04373066772787e+001, -1.65014177146684e+000, 9.27367587936552e+000, 6.50658355769971e-001, 6.89821843838671e+000, -7.63880440767690e+000, -2.38410288932052e+001 },
 {8.27978485977860e-001, 1.43887074051344e+001, -1.25432392550090e+001, 2.47955059484503e+000, -8.25804230951061e+000, 7.90642561051591e+000, 4.02704060028186e+000, -4.80219785146105e+000, -1.23979033486254e+000, 2.42522080546736e-001, -7.42775301389047e+000, -8.26468420686272e-001, -2.21111636638882e+000, 5.54796660306162e+000, -3.43963649169626e+000, -7.83870979020736e+000, -5.11042629126584e+000, 7.32828643274748e+000, -2.83560184966567e+000, 4.52853301634315e+000, -6.38570693484472e+000, -2.51586954849957e+001 },
 {6.96424959328398e+000, 1.80367197944060e+001, -1.42593737202683e+001, 5.50757667322842e+000, -4.14663749627803e+000, 9.32785508911096e+000, 1.50455747985635e+000, -9.71453629016817e+000, 1.56780988609084e-001, -6.98501762828021e-001, -8.94154153475571e+000, 2.03003261213999e+000, 8.35902710335820e-001, 5.36835665520046e-001, -4.76750560010956e+000, -1.01027310926579e+001, -1.88231233579308e+000, 8.11297981785540e+000, 2.15149276611123e+000, 6.17318657652379e+000, -7.01012243986162e+000, -2.04961846038515e+001 } 
};

double Over1cc_4_MLP_22_9_2_hidden_bias[9]={ 3.86207583249933e-001, 4.72999852125481e+000, 3.78566905321776e+000, 5.65351098868460e+000, -1.43344518355007e+000, 1.35282612123753e+000, 2.10679961953075e+000, -2.96012005309775e+000, 2.36830985341041e+000 };

double Over1cc_4_MLP_22_9_2_hidden_output_wts[2][9]=
{
 {-1.28896186969258e+000, 2.23904556080912e+000, 2.22101869912625e+000, 4.16701752234291e+000, -5.33925105845755e+000, 5.61965750429299e+000, 5.07653805425974e-001, -2.90392731942520e+000, 2.84218172908193e+000 },
 {1.30180268993537e+000, -2.27996013867181e+000, -2.16106251107470e+000, -4.20766303756111e+000, 5.36518374303199e+000, -5.61463725226677e+000, -5.23602466293501e-001, 2.82982981651064e+000, -2.87437519892027e+000 }
};

double Over1cc_4_MLP_22_9_2_output_bias[2]={ -3.69099753339815e-001, 3.48336262283165e-001 };

double Over1cc_4_MLP_22_9_2_max_input[22]={ 9.98205853844333e-001, 9.96754273526000e-001, 9.88273973642000e-001, 9.94484586788000e-001, 9.99979798185333e-001, 9.76060123067333e-001, 9.52733284084000e-001, 9.87684635119000e-001, 9.69573341435000e-001, 6.72263999322000e+000, 8.81938425504667e-001, 8.16193723420333e+000, 6.46031687483333e+000, 9.99252106464333e-001, 6.62255613583333e+000, 6.07940450162667e+000, 9.99999999999667e-001, 8.72043766244000e-001, 7.02255299145000e+000, 8.60739480852333e-001, 9.99345923680333e-001, 8.17330004459667e-001 };

double Over1cc_4_MLP_22_9_2_min_input[22]={ 9.52721802638333e-001, 9.43198268998333e-001, 9.25222052145667e-001, 9.22866729721667e-001, 8.14424454238667e-001, 8.49220519646333e-001, 8.08604996355667e-001, 8.10756773806000e-001, 8.12308146372000e-001, 4.59045323467000e+000, 5.74665956678667e-001, 5.22152556633667e+000, 3.66723035187000e+000, 6.35162254726333e-001, 4.08859126770667e+000, 3.25406740473667e+000, 6.17261118161667e-001, 3.89274609002333e-001, 3.28371146222667e+000, 3.66051471635667e-001, 5.87309286467000e-001, 3.12766281606667e-001 };

double Over1cc_4_MLP_22_9_2_input[22];
double Over1cc_4_MLP_22_9_2_hidden[9];
double Over1cc_4_MLP_22_9_2_output[2];

double Over1cc_4_MLP_22_9_2_MeanInputs[22]={ 9.80081546290821e-001, 9.77345870442747e-001, 9.68445460061317e-001, 9.69594031300026e-001, 9.93469783945517e-001, 9.23805996676869e-001, 8.90373090064010e-001, 9.35958806202452e-001, 9.23526263532740e-001, 5.80275234155330e+000, 7.46144412954567e-001, 6.68959782437721e+000, 5.11767729635330e+000, 9.09573969608779e-001, 5.44660949009885e+000, 4.89997422250522e+000, 8.92540199766663e-001, 6.94392499061394e-001, 5.23787381832914e+000, 6.48195949112430e-001, 8.41600640048571e-001, 6.59646113367811e-001 };

void Over1cc_4_MLP_22_9_2_FindMax(double* vec, double* max, long* maxIndex,int len)
{
  long i;
  *max = vec[0];
  *maxIndex = 0;
  for(i=1; i<len; i++)
  {
    if(vec[i]>*max)
    {
      *max = vec[i];
      *maxIndex = i;
    }
  }
}

void Over1cc_4_MLP_22_9_2_ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(Over1cc_4_MLP_22_9_2_max_input[i]-Over1cc_4_MLP_22_9_2_min_input[i]);
	input[i] = minimum - delta*Over1cc_4_MLP_22_9_2_min_input[i]+ delta*input[i];
 }
}

void Over1cc_4_MLP_22_9_2_softmax(double* vec,int len)
{

  long i, j;
  double sum=0.0;
  for(i=0; i<len; i++)
  {
    if(vec[i]>200)
    {
      double max;
      long maxIndex;
      Over1cc_4_MLP_22_9_2_FindMax(vec, &max, &maxIndex,len);
      for(j=0; j<len; j++)
      {        if(j==maxIndex) vec[j] = 1.0;
        else vec[j] = 0.0;
      }
      return;
    }
    else
    {
      vec[i] = exp(vec[i]);
    }
    sum += vec[i];
  }
  if(sum==0)
  {
   long a = 1;
  }
  if(sum!=0.0)
  {
    for(i=0; i<len; i++) vec[i] = vec[i]/sum;
  }
  else for(i=0; i<len; i++) vec[i] = 1.0/(double)len;
}

double Over1cc_4_MLP_22_9_2_logistic(double x)
{
  if(x > 100.0) x = 1.0;
  else if (x < -100.0) x = 0.0;
  else x = 1.0/(1.0+exp(-x));
  return x;
}

void Over1cc_4_MLP_22_9_2_ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = Over1cc_4_MLP_22_9_2_logistic(V_OUT[row]);
   }
}

void Over1cc_4_MLP_22_9_2_RunNeuralNet_Classification () 
{
  Over1cc_4_MLP_22_9_2_ComputeFeedForwardSignals((double*)Over1cc_4_MLP_22_9_2_input_hidden_weights,Over1cc_4_MLP_22_9_2_input,Over1cc_4_MLP_22_9_2_hidden,Over1cc_4_MLP_22_9_2_hidden_bias,22, 9,0);
  Over1cc_4_MLP_22_9_2_ComputeFeedForwardSignals((double*)Over1cc_4_MLP_22_9_2_hidden_output_wts,Over1cc_4_MLP_22_9_2_hidden,Over1cc_4_MLP_22_9_2_output,Over1cc_4_MLP_22_9_2_output_bias,9, 2,1);
}

int main()
{
  int cont_inps;
  int index;
  int i=0;
  int keyin=1;
  double max;
  while(1)
  {
	max=3.e-300;
	printf("\n%s\n","Enter values for Continuous inputs (To skip a continuous input please enter -9999)");
	printf("%s","Cont. Input-0(wavelet-HLLglcmIdmn): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[0]);
	printf("%s","Cont. Input-1(wavelet-LHLglcmIdmn): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[1]);
	printf("%s","Cont. Input-2(wavelet-LLLglrlmRunLengthNonUniformityNormalized): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[2]);
	printf("%s","Cont. Input-3(wavelet-LHHglcmIdmn): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[3]);
	printf("%s","Cont. Input-4(wavelet-LLHglcmImc2): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[4]);
	printf("%s","Cont. Input-5(wavelet-HHLglcmIdn): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[5]);
	printf("%s","Cont. Input-6(originalglcmIdn): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[6]);
	printf("%s","Cont. Input-7(wavelet-LHLglrlmShortRunEmphasis): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[7]);
	printf("%s","Cont. Input-8(originalglrlmRunLengthNonUniformityNormalized): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[8]);
	printf("%s","Cont. Input-9(wavelet-LHHgldmDependenceEntropy): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[9]);
	printf("%s","Cont. Input-10(originalglszmSmallAreaEmphasis): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[10]);
	printf("%s","Cont. Input-11(wavelet-LLLglszmZoneEntropy): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[11]);
	printf("%s","Cont. Input-12(originalglrlmRunEntropy): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[12]);
	printf("%s","Cont. Input-13(wavelet-LLLglcmMCC): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[13]);
	printf("%s","Cont. Input-14(wavelet-LHLglszmZoneEntropy): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[14]);
	printf("%s","Cont. Input-15(wavelet-LLLglcmDifferenceEntropy): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[15]);
	printf("%s","Cont. Input-16(wavelet-LLHglcmMCC): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[16]);
	printf("%s","Cont. Input-17(wavelet-LHHglszmSmallAreaEmphasis): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[17]);
	printf("%s","Cont. Input-18(originalglcmSumEntropy): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[18]);
	printf("%s","Cont. Input-19(wavelet-LHLglszmSmallAreaEmphasis): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[19]);
	printf("%s","Cont. Input-20(wavelet-HLLglcmImc2): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[20]);
	printf("%s","Cont. Input-21(originalshapeSphericity): ");
	scanf("%lg",&Over1cc_4_MLP_22_9_2_input[21]);
	for(cont_inps=0;cont_inps<22;cont_inps++)
	{
     //Substitution of missing continuous variables
     if(Over1cc_4_MLP_22_9_2_input[cont_inps] == -9999)
	  Over1cc_4_MLP_22_9_2_input[cont_inps]=Over1cc_4_MLP_22_9_2_MeanInputs[cont_inps];
	}
    Over1cc_4_MLP_22_9_2_ScaleInputs(Over1cc_4_MLP_22_9_2_input,0,1,22);
	Over1cc_4_MLP_22_9_2_RunNeuralNet_Classification();
   //Output Activation is Softmax;
	Over1cc_4_MLP_22_9_2_softmax(Over1cc_4_MLP_22_9_2_output, 2);
	for(i=0;i<2;i++)
	{
      if(max<Over1cc_4_MLP_22_9_2_output[i])
      {
        max=Over1cc_4_MLP_22_9_2_output[i];
        index=i+1;
      }
	}
	printf("\n%s","Predicted category = ");

    switch(index)
    {
        case 1: printf("%s\n","0"); break;
        case 2: printf("%s\n","1"); break;
        default: break;
    }
    printf("\n%s%.14f","Confidence level = ",max);
	printf("\n\n%s\n","Press any key to make another prediction or enter 0 to quit the program.");
	keyin=getch();
	if(keyin==48)break;
  }
	return 0;
}

