//Analysis Type - Classification 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double TN_1_2_MLP_22_11_2_input_hidden_weights[11][22]=
{
 {-4.51325686885543e+000, -2.32931355185614e+000, -6.40902113101299e-001, -7.54169217448092e-001, -2.23534624604748e+000, 6.83115285420796e-001, 2.19336881345548e+000, 9.90229732312208e-001, 1.38601329237469e-001, 9.40413921410704e-001, -1.64097984523219e+000, 7.59629356830363e-001, 7.91819817368445e-001, 9.79036469204888e-001, -1.74364811688690e+000, -3.09300065525963e+000, -9.26447412027326e-001, -6.82986454661797e-001, -2.68959097733439e-002, 5.53451790680352e-001, 4.83387984175137e-001, 2.28420539534772e-001 },
 {7.36173039247695e+000, 1.76897425426247e+000, 1.48034408044413e+000, -2.16948511605447e+000, 3.89167208036558e-001, 3.82516975753656e-002, -6.21818291449923e+000, 5.37693866687329e-002, -2.98271746371165e+000, -1.82635712074111e+000, 2.61800528029946e+000, -1.87629984797279e+000, -4.57740566816446e+000, -2.55237388459879e+000, -2.63149151378686e-001, 4.09409192055142e+000, -3.65714043487255e+000, -6.67167021908157e-001, -1.66886492797132e-001, -3.78027333742350e+000, -4.23768212671361e+000, -4.51446287404835e+000 },
 {9.03349495263115e+000, 6.81379742409441e+000, 2.02529161669172e+000, 2.47869305541590e+000, 1.22118211902014e+001, -2.65655952853233e+000, -8.36529428169785e+000, 4.72553184486676e+000, 1.74836163947749e+000, -9.83273748118400e+000, -4.20371649044580e+000, -1.36665797432754e+001, 2.22331919640671e+000, -1.07456720638639e+001, 1.44148145916444e+001, 5.32574669210781e+000, 8.74247002509776e+000, 2.45438380817960e+000, -1.06771297663931e+001, -2.32317501276054e-001, -5.96842649575298e+000, 4.55822471993828e+000 },
 {3.43848139737543e+000, 5.43624204739686e+000, -1.93132325295506e+000, -4.57203860525033e+000, 1.08167593858776e+001, -1.10820290505822e+000, -1.00038241321231e+001, -1.70219796021098e+000, 5.99413420694030e+000, -9.95637895627691e+000, -3.46783922932727e+000, -1.16601653188596e+001, -4.50793170777665e+000, -9.74319265115935e+000, 1.80433841848720e+001, 1.19593395523237e+001, 5.03360988071691e+000, 6.93428334821836e+000, -9.66668224421924e+000, -1.92922231890130e+000, -1.75965581722872e+001, 4.90571465518873e+000 },
 {-1.40790089561716e+001, -7.77853048510165e+000, 4.35293109223343e-001, -8.33906325673757e-002, -6.64354259780002e+000, 5.10861976949162e+000, 6.30655252072692e+000, 1.14575985233831e+001, 4.03734110665445e+000, 2.05440166772728e+000, -6.27249557332975e+000, 1.63849935032808e+000, 6.00601785502485e+000, 3.23894845686973e+000, -8.15655320600557e+000, -1.21919931690698e+001, -2.09520181653896e+000, -2.27109611195007e+000, -5.12472784188759e-001, 2.75989853009276e+000, 2.83297773611690e+000, 3.87007867510563e-001 },
 {-7.02150856510588e-002, -6.62532943370309e-003, 8.56364935753381e-001, 9.10404722224695e-001, -2.66390874312302e-001, 8.72908526434412e-001, 1.14591517454953e+000, 1.38249188317473e+000, 1.17909671152517e-001, 1.07773567093589e+000, 2.06820505310464e-001, 7.44726991499468e-001, 7.54167248136700e-001, 8.66263432827372e-001, -1.25789945878298e+000, -8.87886703295010e-001, -2.34679236012787e-001, -4.41170218087217e-002, 6.63900485327806e-001, 7.64323451347789e-001, 1.58211447343347e+000, -1.52937939283030e-001 },
 {-1.85508968305915e+000, 1.39427835235162e-001, 6.30420900370275e-001, 1.11730921140959e+000, 6.15230302752834e-001, 1.33259174344706e+000, 2.43038217978082e+000, 1.51344427710606e+000, 1.64788699261264e+000, 1.09055314404178e+000, -6.90251252759543e-001, 6.48065385707206e-001, 1.78377824388506e+000, 1.08090703754443e+000, 3.24592217880848e-001, -8.16484606375818e-001, 1.08177951168736e+000, 9.09674626963970e-001, 1.99760724390151e-001, 1.82915774069654e+000, 1.13591164838116e+000, 1.51012274315659e+000 },
 {-7.80584051814303e-001, -6.69664173217722e-001, -2.76813097731785e+000, -2.91954204334852e+000, -9.84212184267248e-002, -2.27699993890561e+000, -2.74384841437745e+000, -4.21467223359997e+000, -2.56672932768081e-001, -2.68666517357634e+000, -6.65732002106924e-001, -1.53219949877988e+000, -2.63792238312186e+000, -2.09793515890570e+000, 2.70081329389935e+000, 1.98926555420480e+000, -1.61071716722015e-001, 1.24631717088866e-001, -1.54425853119095e+000, -2.20122925152516e+000, -4.16574059321426e+000, 2.95555310741080e-001 },
 {-3.10793285992176e+000, -7.54755981854038e+000, 2.66550989456806e+000, 3.95998472524676e+000, -1.55930330543854e+001, 1.25269467843091e+000, 1.14140003956205e+001, 4.52174968247083e-001, -9.66734860602743e+000, 1.35964024004310e+001, 5.93299332681453e+000, 1.56155521236534e+001, 3.26044554502664e+000, 1.28967047338482e+001, -2.45319542009330e+001, -1.42255723745294e+001, -9.48768210964524e+000, -9.61021887320847e+000, 1.33432353600103e+001, 8.55630814938464e-001, 2.03010937575138e+001, -9.37595946431054e+000 },
 {-3.85868294681793e+000, -2.59500056019746e+000, -9.59164384754104e-001, -2.87145631611696e-001, -2.38553122906745e+000, -1.09698269981182e+000, 2.23500354171545e+000, -5.27793324410086e-001, -1.28041699503437e+000, 1.14150029089407e+000, -6.77617982244446e-001, 1.71565290179673e+000, 1.63654136923775e+000, 1.62721357373245e+000, -2.95644896915371e+000, -4.31267694906444e+000, -5.04912908642953e-001, -1.86365989752243e+000, 7.71805061205748e-001, 3.04176422555329e-001, 1.60236572862944e+000, -1.67570458825598e+000 },
 {3.37051340871233e+000, 1.74588030996436e+000, 2.72245673808044e-001, -1.86274348547365e+000, 2.50469905096338e+000, -4.53309411966642e-001, -5.47460960909986e+000, 1.02633583352519e+000, -5.05365383901224e-001, -4.18170062851129e+000, -1.59079050606252e+000, -5.72846552041637e+000, -2.61682326837284e+000, -5.13726803071033e+000, 3.43315571667680e+000, 2.48262525545063e+000, -7.52541846368571e-002, 2.61914759088513e-001, -4.38353077731746e+000, -1.81120752622574e+000, -4.81835787495144e+000, -6.06093321885572e-001 } 
};

double TN_1_2_MLP_22_11_2_hidden_bias[11]={ -1.83128867233661e+000, 1.41948637319211e-001, 7.54580493656465e+000, -1.19525939254077e+000, -3.42982074453073e+000, 7.49011982671797e-001, 6.91548306631006e-001, -2.89544987256667e+000, 7.18162495082535e-002, -1.68827249038244e+000, 6.15972479955824e-001 };

double TN_1_2_MLP_22_11_2_hidden_output_wts[2][11]=
{
 {-2.97154399294289e+000, 7.70107838375446e+000, 9.08211568302423e+000, 2.33751226270963e+000, -7.20203856429955e+000, 5.93006876596587e-001, -1.89018725477396e+000, -1.26264096638163e+000, -2.48098705057104e+000, -1.87084967005167e+000, 6.67648516063592e+000 },
 {1.97422641207788e+000, -6.33143508119508e+000, -9.65374353703805e+000, -1.70057291857449e+000, 7.76689826729704e+000, -4.46437524381767e-001, 2.23234102275973e+000, 6.74161795473471e-001, 2.45154969628847e+000, 1.79019536703931e+000, -9.01373720921852e+000 }
};

double TN_1_2_MLP_22_11_2_output_bias[2]={ 5.43852571172487e-001, -2.20565615585453e+000 };

double TN_1_2_MLP_22_11_2_max_input[22]={ 9.98205853844333e-001, 9.98278127930000e-001, 9.97102711270667e-001, 9.99979798185333e-001, 9.85907962998000e-001, 9.76060123067333e-001, 9.69573341435000e-001, 9.88361539433000e-001, 9.67474315403000e-001, 6.77785077092000e+000, 8.16193723420333e+000, 6.46031687483333e+000, 9.99316191677333e-001, 6.07940450162667e+000, 9.57964581975667e-001, 6.71294571244000e+000, 9.99999999999667e-001, 5.17577777731667e+000, 7.02255299145000e+000, 8.60739480852333e-001, 8.17330004459667e-001, 9.99712242127000e-001 };

double TN_1_2_MLP_22_11_2_min_input[22]={ 9.52721802638333e-001, 8.93705061552667e-001, 9.17629414271333e-001, 8.14424454238667e-001, 8.06267137025000e-001, 8.60101696074000e-001, 8.12308146372000e-001, 8.30485571062667e-001, 7.30127857169000e-001, 4.60643372615000e+000, 5.30000733675333e+000, 4.01210318245333e+000, 6.59873139234333e-001, 3.25406740473667e+000, 6.07910368052667e-001, 3.78874837243333e+000, 6.17261118161667e-001, 3.03813268853333e+000, 3.45214241290333e+000, 2.33669934136333e-001, 3.12766281606667e-001, 5.40999113597333e-001 };

double TN_1_2_MLP_22_11_2_input[22];
double TN_1_2_MLP_22_11_2_hidden[11];
double TN_1_2_MLP_22_11_2_output[2];

double TN_1_2_MLP_22_11_2_MeanInputs[22]={ 9.80044802295625e-001, 9.77491341848946e-001, 9.72327345698061e-001, 9.92932614739722e-001, 9.45962721264683e-001, 9.22808703059702e-001, 9.23331561691087e-001, 9.45256645895686e-001, 8.71327342031888e-001, 5.83507039367946e+000, 6.66331154121907e+000, 5.10522097299981e+000, 9.14673531002154e-001, 4.86726459960263e+000, 7.70510779316625e-001, 5.50287463832869e+000, 8.93670683957503e-001, 4.15130051789327e+000, 5.21216796607840e+000, 6.47802369883849e-001, 6.60728465309429e-001, 8.45001887949218e-001 };

void TN_1_2_MLP_22_11_2_ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(TN_1_2_MLP_22_11_2_max_input[i]-TN_1_2_MLP_22_11_2_min_input[i]);
	input[i] = minimum - delta*TN_1_2_MLP_22_11_2_min_input[i]+ delta*input[i];
 }
}

double TN_1_2_MLP_22_11_2_logistic(double x)
{
  if(x > 100.0) x = 1.0;
  else if (x < -100.0) x = 0.0;
  else x = 1.0/(1.0+exp(-x));
  return x;
}

void TN_1_2_MLP_22_11_2_Normalise(double out[],long length)
{
  long i, j;
  double sum = 0.0;
  for(i=0; i<length; i++)
  {
   if(out[i]>100)
   {
    out[i] = 1.0;
    j = i;
    for(i=0; i<length; i++)
    {
     if(i!=j) out[i] = 0.0;
    }
    break;
   }
   else out[i] = exp(out[i]);
  }
  for(i=0; i<length; i++)
  {
   sum += out[i];
  }
  for(i=0; i<length; i++)
  {
   out[i] = out[i]/sum;
  }
}

void TN_1_2_MLP_22_11_2_ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = tanh(V_OUT[row]);
      if(layer==1) V_OUT[row] = TN_1_2_MLP_22_11_2_logistic(V_OUT[row]);
   }
}

void TN_1_2_MLP_22_11_2_RunNeuralNet_Classification () 
{
  TN_1_2_MLP_22_11_2_ComputeFeedForwardSignals((double*)TN_1_2_MLP_22_11_2_input_hidden_weights,TN_1_2_MLP_22_11_2_input,TN_1_2_MLP_22_11_2_hidden,TN_1_2_MLP_22_11_2_hidden_bias,22, 11,0);
  TN_1_2_MLP_22_11_2_ComputeFeedForwardSignals((double*)TN_1_2_MLP_22_11_2_hidden_output_wts,TN_1_2_MLP_22_11_2_hidden,TN_1_2_MLP_22_11_2_output,TN_1_2_MLP_22_11_2_output_bias,11, 2,1);
}

int main()
{
  int cont_inps;
  int index;
  int i=0;
  int keyin=1;
  double max;
  while(1)
  {
	max=3.e-300;
	printf("\n%s\n","Enter values for Continuous inputs (To skip a continuous input please enter -9999)");
	printf("%s","Cont. Input-0(wavelet-HLLglcmIdmn): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[0]);
	printf("%s","Cont. Input-1(wavelet-HHHglcmIdmn): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[1]);
	printf("%s","Cont. Input-2(wavelet-HLHglcmIdmn): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[2]);
	printf("%s","Cont. Input-3(wavelet-LLHglcmImc2): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[3]);
	printf("%s","Cont. Input-4(wavelet-LHHglrlmShortRunEmphasis): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[4]);
	printf("%s","Cont. Input-5(wavelet-HHLglcmIdn): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[5]);
	printf("%s","Cont. Input-6(originalglrlmRunLengthNonUniformityNormalized): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[6]);
	printf("%s","Cont. Input-7(wavelet-LLHglcmIdmn): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[7]);
	printf("%s","Cont. Input-8(wavelet-LLHglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[8]);
	printf("%s","Cont. Input-9(wavelet-LHLgldmDependenceEntropy): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[9]);
	printf("%s","Cont. Input-10(wavelet-LLLglszmZoneEntropy): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[10]);
	printf("%s","Cont. Input-11(originalglrlmRunEntropy): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[11]);
	printf("%s","Cont. Input-12(wavelet-LLLglcmMCC): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[12]);
	printf("%s","Cont. Input-13(wavelet-LLLglcmDifferenceEntropy): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[13]);
	printf("%s","Cont. Input-14(wavelet-HHLglrlmRunPercentage): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[14]);
	printf("%s","Cont. Input-15(wavelet-HLHglszmZoneEntropy): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[15]);
	printf("%s","Cont. Input-16(wavelet-LLHglcmMCC): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[16]);
	printf("%s","Cont. Input-17(wavelet-LHHglrlmRunEntropy): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[17]);
	printf("%s","Cont. Input-18(originalglcmSumEntropy): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[18]);
	printf("%s","Cont. Input-19(wavelet-LHLglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[19]);
	printf("%s","Cont. Input-20(originalshapeSphericity): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[20]);
	printf("%s","Cont. Input-21(wavelet-HLHglcmImc2): ");
	scanf("%lg",&TN_1_2_MLP_22_11_2_input[21]);
	for(cont_inps=0;cont_inps<22;cont_inps++)
	{
     //Substitution of missing continuous variables
     if(TN_1_2_MLP_22_11_2_input[cont_inps] == -9999)
	  TN_1_2_MLP_22_11_2_input[cont_inps]=TN_1_2_MLP_22_11_2_MeanInputs[cont_inps];
	}
    TN_1_2_MLP_22_11_2_ScaleInputs(TN_1_2_MLP_22_11_2_input,0,1,22);
	TN_1_2_MLP_22_11_2_RunNeuralNet_Classification();
   //Normalise output if output activation is not Softmax;
 	TN_1_2_MLP_22_11_2_Normalise(TN_1_2_MLP_22_11_2_output,2);
	for(i=0;i<2;i++)
	{
      if(max<TN_1_2_MLP_22_11_2_output[i])
      {
        max=TN_1_2_MLP_22_11_2_output[i];
        index=i+1;
      }
	}
	printf("\n%s","Predicted category = ");

    switch(index)
    {
        case 1: printf("%s\n","0"); break;
        case 2: printf("%s\n","1"); break;
        default: break;
    }
    printf("\n%s%.14f","Confidence level = ",max);
	printf("\n\n%s\n","Press any key to make another prediction or enter 0 to quit the program.");
	keyin=getch();
	if(keyin==48)break;
  }
	return 0;
}

