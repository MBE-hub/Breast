//Analysis Type - Classification 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double TN_1_9_MLP_22_12_2_input_hidden_weights[12][22]=
{
 {7.97647529375659e-002, 1.19615207144352e-001, -3.27098186872870e-002, -5.94761250607158e-002, 2.30909870110873e-001, -1.05839447420567e-001, -1.48781917886543e-001, -7.51141718441234e-003, 1.69020006382575e-001, -2.03669608333131e-001, -1.43374522276345e-001, -3.32431455623971e-001, -4.03704495019005e-002, -2.74522057124561e-001, 4.25568048170984e-001, 1.46617038916339e-001, 2.50107600408395e-001, 6.48530994609835e-002, -2.65167615477083e-001, 7.73405699737751e-002, -2.88884531912853e-001, 2.11384704412473e-001 },
 {3.63151543865252e-003, -5.92733705821744e-002, -7.67708150125450e-002, -7.10655275298062e-002, 1.59125590795155e-002, -3.90507201885886e-002, -9.46732796030339e-002, -6.47467577013442e-002, -1.63620995924259e-001, -1.14730606933675e-001, 6.29377541802072e-002, -8.29363074999419e-003, -1.52881165683036e-001, -5.18265207195630e-003, -1.27463723286841e-001, 4.52125084607138e-002, -1.97004681749182e-001, 6.22494656011216e-002, 9.81353851840928e-002, -2.26824554330423e-001, 3.93545371891308e-003, -1.98516197181554e-001 },
 {7.73070817989557e-002, -1.39097281304137e-001, -3.34418846917487e-002, 7.82814267606698e-003, -6.10592175608171e-002, -6.24597503288859e-002, -2.64307864724353e-002, -8.25847296789816e-002, -1.73977494539171e-001, 6.43651918852727e-004, 1.11522756321068e-001, 9.49011726307485e-002, -5.04527876595405e-002, 1.07801453467878e-001, -3.15311512515262e-001, -8.29314282815695e-002, -1.95189366669631e-001, -1.52259493357883e-002, 2.32228092637793e-001, -1.98754357080914e-001, 1.39666738657342e-001, -2.76925752999624e-001 },
 {3.90676163288709e-002, 2.52627780331512e-001, -1.36924111383037e-001, -1.33439832595467e-001, 5.66182929177610e-001, 3.41101831165616e-002, -4.12231054785093e-001, -1.78029452488575e-002, 3.13566003402187e-001, -4.98448645084004e-001, -1.90072578137953e-001, -5.25310148545382e-001, -1.25738887839978e-001, -4.39126279697881e-001, 8.40014834874704e-001, 5.98301501306732e-001, 3.28505813038257e-001, 3.88239609925546e-001, -4.07493172196286e-001, -1.36211634596981e-001, -6.67034302058837e-001, 3.05578063348416e-001 },
 {2.31911151431663e-001, 4.23950201221493e-002, 7.87144590843080e-002, -2.71667349325512e-002, -1.13567394217501e-002, -2.45157606636646e-002, -1.58282019734430e-001, 1.67218947629282e-001, -7.11016270211725e-002, 1.62593229938681e-002, -9.81081803162786e-002, -1.56546121473414e-001, -4.30793586212962e-002, -1.49022072018192e-001, 5.99900147362869e-002, -1.30869650346920e-001, -9.79207352962380e-002, -1.40168863512143e-001, -2.80080541151578e-001, 1.52920713320924e-001, -1.19255778825475e-001, -1.55426139910819e-002 },
 {-1.95569146215144e-001, -3.35684082951601e-001, -9.24306264830778e-003, 1.93395041640480e-002, -5.05247980704108e-001, 6.00291020683705e-002, 4.02747699421188e-001, -2.47337206418286e-001, -3.09680553251403e-001, 4.20488129747560e-001, 4.41879650487963e-001, 8.76746320694794e-001, 8.07062410307032e-002, 6.07487128193402e-001, -1.06601230289670e+000, -3.53246263211350e-001, -5.13812200392040e-001, -1.46667566701854e-001, 8.12906426081882e-001, -2.14529579176360e-001, 6.40519400542996e-001, -6.59472281136057e-001 },
 {-1.83238496041953e-001, -3.35893089790141e-001, 1.08658713591986e-001, 1.21469385306244e-001, -5.44751691702506e-001, 7.29151604762868e-002, 5.23835877775970e-001, 3.48113212584954e-002, -3.00289006442363e-001, 6.05808841862496e-001, 2.67191813927468e-001, 6.88712219913926e-001, 8.34444650382424e-002, 5.60372865490242e-001, -9.02158708555035e-001, -4.98614459326252e-001, -3.57890004217306e-001, -2.94312517143671e-001, 5.46533162726979e-001, 1.07962739260188e-001, 6.87035021794651e-001, -3.24349776400436e-001 },
 {8.30011642063467e-001, 5.64069150207714e-001, 1.04892057705962e-001, 1.68209303115922e-001, 9.45900356984974e-001, -9.38598535768024e-002, -6.99120318093528e-001, 1.99128018655469e-001, 7.28044002666471e-002, -6.61905513192875e-001, -1.08603493266161e-001, -8.46256931157587e-001, 7.06842938811264e-002, -5.85189962911559e-001, 8.93275766982627e-001, 5.89094838021229e-001, 4.40106633777295e-001, 2.71815157151210e-001, -5.34420120676862e-001, -1.77758921219821e-001, -6.91218861775227e-001, -7.71208029156432e-002 },
 {-3.59023139427151e-001, 2.07076156480146e-002, 1.44612649258668e-001, 8.49802143225084e-002, -1.34027328154089e-001, 2.37916899832063e-001, 2.94954793833966e-001, 2.43450984127127e-001, 9.22433669720860e-002, 3.00367168096808e-001, -1.32953591177965e-001, 1.48779807669812e-001, 1.31609680377609e-001, 1.65565413454169e-001, -6.94779432397603e-002, -2.98015351948617e-001, 6.89019507926548e-002, -7.13556481754039e-002, -6.73700415354724e-002, 5.31078530780054e-001, 2.49385902712128e-001, 3.11029218452135e-001 },
 {-3.12070360037216e-001, -2.38578484382013e-001, -5.29267534408079e-002, 3.06136791964519e-002, -3.14378035194703e-001, 9.55012038276948e-003, 3.13846142025030e-001, -8.48464181097939e-002, -3.28347654222958e-002, 2.43333517147292e-001, 2.14260629594710e-002, 3.69757170904989e-001, 1.06467983090240e-001, 2.95206149653575e-001, -4.14617178106668e-001, -3.05211074054299e-001, -1.02929820913652e-001, -9.70786615829068e-002, 2.39673129450406e-001, -9.00802051381233e-003, 4.39944130918937e-001, 3.45705387377104e-004 },
 {8.49074094074159e-002, 2.42621370400568e-001, 1.36980324643886e-002, 3.79759183187555e-002, 4.43104824800733e-001, -2.44245962483372e-002, -1.60938987623267e-001, -3.13944463789267e-002, 1.50837727600026e-001, -3.11999417215964e-001, 7.43201908992219e-002, -2.01496343764959e-001, 6.10455439907620e-002, -1.15827883045604e-001, 3.56295446906370e-001, 4.14154222267758e-001, 2.02318199823996e-001, 2.68387872182422e-001, -6.15315728316777e-002, -1.15173509362793e-001, -2.26399546969105e-001, 5.72305103748438e-002 },
 {6.52935826785359e-001, 4.31315899775704e-001, -6.23711484641248e-002, 2.73199539038866e-001, 9.70389780218973e-001, -2.69009562387580e-001, -5.40606147566163e-001, -1.94539970101722e-001, 5.22591283169964e-002, -8.19212900838224e-001, 5.22663825560703e-002, -6.12541407184941e-001, 2.49274622414113e-001, -4.74367502209541e-001, 5.98491052225452e-001, 6.77010964586142e-001, 4.68570382082867e-001, 1.82263850575544e-001, -1.82088385101441e-001, -4.64150575306191e-001, -2.16771873068282e-001, -1.05752446713862e-001 } 
};

double TN_1_9_MLP_22_12_2_hidden_bias[12]={ 6.72867910279994e-002, -2.01073131437065e-001, -1.51618235941424e-001, -4.61017544575044e-002, 1.84030949344590e-001, -2.65812755830536e-001, -1.02688403805394e-001, 4.01385162783045e-001, 1.08957852230079e-001, -1.18338240413573e-001, 2.88804982078062e-002, 2.84318541628705e-001 };

double TN_1_9_MLP_22_12_2_hidden_output_wts[2][12]=
{
 {-2.32404013358486e-001, 5.05197362103053e-001, 3.75604364850687e-001, 3.10169485503813e-001, 2.45980661526358e-001, 2.26789311826071e-001, -8.88394038634817e-002, 1.25342464383503e+000, -6.79624755879757e-001, -5.72846107341770e-001, 3.36888496617347e-001, 7.12357922660193e-001 },
 {1.64797553374457e-001, -5.39244392079058e-001, -4.30480663405541e-001, -4.30370698299158e-001, 3.94544376840570e-001, -5.87712064056459e-001, -8.06880309298491e-002, -4.27966900775685e-001, 8.19995267071686e-001, -4.72343964000093e-002, -4.22816173369692e-001, -1.50988471618818e+000 }
};

double TN_1_9_MLP_22_12_2_output_bias[2]={ 1.28304880288542e+000, 1.71227452144857e-001 };

double TN_1_9_MLP_22_12_2_max_input[22]={ 9.98205853844333e-001, 9.98278127930000e-001, 9.97102711270667e-001, 9.99979798185333e-001, 9.85907962998000e-001, 9.76060123067333e-001, 9.69573341435000e-001, 9.88361539433000e-001, 9.67474315403000e-001, 6.77785077092000e+000, 8.16193723420333e+000, 6.46031687483333e+000, 9.99316191677333e-001, 6.07940450162667e+000, 9.57964581975667e-001, 6.71294571244000e+000, 9.99999999999667e-001, 5.17577777731667e+000, 7.02255299145000e+000, 8.60739480852333e-001, 8.17330004459667e-001, 9.99712242127000e-001 };

double TN_1_9_MLP_22_12_2_min_input[22]={ 9.52721802638333e-001, 8.93705061552667e-001, 9.17629414271333e-001, 8.14424454238667e-001, 8.06267137025000e-001, 8.60101696074000e-001, 8.12308146372000e-001, 8.30485571062667e-001, 7.30127857169000e-001, 4.60643372615000e+000, 5.30000733675333e+000, 4.01210318245333e+000, 6.59873139234333e-001, 3.25406740473667e+000, 6.07910368052667e-001, 3.78874837243333e+000, 6.17261118161667e-001, 3.03813268853333e+000, 3.45214241290333e+000, 2.33669934136333e-001, 3.12766281606667e-001, 5.40999113597333e-001 };

double TN_1_9_MLP_22_12_2_input[22];
double TN_1_9_MLP_22_12_2_hidden[12];
double TN_1_9_MLP_22_12_2_output[2];

double TN_1_9_MLP_22_12_2_MeanInputs[22]={ 9.80044802295625e-001, 9.77491341848946e-001, 9.72327345698061e-001, 9.92932614739722e-001, 9.45962721264683e-001, 9.22808703059702e-001, 9.23331561691087e-001, 9.45256645895686e-001, 8.71327342031888e-001, 5.83507039367946e+000, 6.66331154121907e+000, 5.10522097299981e+000, 9.14673531002154e-001, 4.86726459960263e+000, 7.70510779316625e-001, 5.50287463832869e+000, 8.93670683957503e-001, 4.15130051789327e+000, 5.21216796607840e+000, 6.47802369883849e-001, 6.60728465309429e-001, 8.45001887949218e-001 };

void TN_1_9_MLP_22_12_2_ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(TN_1_9_MLP_22_12_2_max_input[i]-TN_1_9_MLP_22_12_2_min_input[i]);
	input[i] = minimum - delta*TN_1_9_MLP_22_12_2_min_input[i]+ delta*input[i];
 }
}

void TN_1_9_MLP_22_12_2_Normalise(double out[],long length)
{
  long i, j;
  double sum = 0.0;
  for(i=0; i<length; i++)
  {
   if(out[i]>100)
   {
    out[i] = 1.0;
    j = i;
    for(i=0; i<length; i++)
    {
     if(i!=j) out[i] = 0.0;
    }
    break;
   }
   else out[i] = exp(out[i]);
  }
  for(i=0; i<length; i++)
  {
   sum += out[i];
  }
  for(i=0; i<length; i++)
  {
   out[i] = out[i]/sum;
  }
}

void TN_1_9_MLP_22_12_2_ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = tanh(V_OUT[row]);
      if(layer==1) V_OUT[row] = tanh(V_OUT[row]);
   }
}

void TN_1_9_MLP_22_12_2_RunNeuralNet_Classification () 
{
  TN_1_9_MLP_22_12_2_ComputeFeedForwardSignals((double*)TN_1_9_MLP_22_12_2_input_hidden_weights,TN_1_9_MLP_22_12_2_input,TN_1_9_MLP_22_12_2_hidden,TN_1_9_MLP_22_12_2_hidden_bias,22, 12,0);
  TN_1_9_MLP_22_12_2_ComputeFeedForwardSignals((double*)TN_1_9_MLP_22_12_2_hidden_output_wts,TN_1_9_MLP_22_12_2_hidden,TN_1_9_MLP_22_12_2_output,TN_1_9_MLP_22_12_2_output_bias,12, 2,1);
}

int main()
{
  int cont_inps;
  int index;
  int i=0;
  int keyin=1;
  double max;
  while(1)
  {
	max=3.e-300;
	printf("\n%s\n","Enter values for Continuous inputs (To skip a continuous input please enter -9999)");
	printf("%s","Cont. Input-0(wavelet-HLLglcmIdmn): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[0]);
	printf("%s","Cont. Input-1(wavelet-HHHglcmIdmn): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[1]);
	printf("%s","Cont. Input-2(wavelet-HLHglcmIdmn): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[2]);
	printf("%s","Cont. Input-3(wavelet-LLHglcmImc2): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[3]);
	printf("%s","Cont. Input-4(wavelet-LHHglrlmShortRunEmphasis): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[4]);
	printf("%s","Cont. Input-5(wavelet-HHLglcmIdn): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[5]);
	printf("%s","Cont. Input-6(originalglrlmRunLengthNonUniformityNormalized): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[6]);
	printf("%s","Cont. Input-7(wavelet-LLHglcmIdmn): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[7]);
	printf("%s","Cont. Input-8(wavelet-LLHglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[8]);
	printf("%s","Cont. Input-9(wavelet-LHLgldmDependenceEntropy): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[9]);
	printf("%s","Cont. Input-10(wavelet-LLLglszmZoneEntropy): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[10]);
	printf("%s","Cont. Input-11(originalglrlmRunEntropy): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[11]);
	printf("%s","Cont. Input-12(wavelet-LLLglcmMCC): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[12]);
	printf("%s","Cont. Input-13(wavelet-LLLglcmDifferenceEntropy): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[13]);
	printf("%s","Cont. Input-14(wavelet-HHLglrlmRunPercentage): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[14]);
	printf("%s","Cont. Input-15(wavelet-HLHglszmZoneEntropy): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[15]);
	printf("%s","Cont. Input-16(wavelet-LLHglcmMCC): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[16]);
	printf("%s","Cont. Input-17(wavelet-LHHglrlmRunEntropy): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[17]);
	printf("%s","Cont. Input-18(originalglcmSumEntropy): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[18]);
	printf("%s","Cont. Input-19(wavelet-LHLglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[19]);
	printf("%s","Cont. Input-20(originalshapeSphericity): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[20]);
	printf("%s","Cont. Input-21(wavelet-HLHglcmImc2): ");
	scanf("%lg",&TN_1_9_MLP_22_12_2_input[21]);
	for(cont_inps=0;cont_inps<22;cont_inps++)
	{
     //Substitution of missing continuous variables
     if(TN_1_9_MLP_22_12_2_input[cont_inps] == -9999)
	  TN_1_9_MLP_22_12_2_input[cont_inps]=TN_1_9_MLP_22_12_2_MeanInputs[cont_inps];
	}
    TN_1_9_MLP_22_12_2_ScaleInputs(TN_1_9_MLP_22_12_2_input,0,1,22);
	TN_1_9_MLP_22_12_2_RunNeuralNet_Classification();
   //Normalise output if output activation is not Softmax;
 	TN_1_9_MLP_22_12_2_Normalise(TN_1_9_MLP_22_12_2_output,2);
	for(i=0;i<2;i++)
	{
      if(max<TN_1_9_MLP_22_12_2_output[i])
      {
        max=TN_1_9_MLP_22_12_2_output[i];
        index=i+1;
      }
	}
	printf("\n%s","Predicted category = ");

    switch(index)
    {
        case 1: printf("%s\n","0"); break;
        case 2: printf("%s\n","1"); break;
        default: break;
    }
    printf("\n%s%.14f","Confidence level = ",max);
	printf("\n\n%s\n","Press any key to make another prediction or enter 0 to quit the program.");
	keyin=getch();
	if(keyin==48)break;
  }
	return 0;
}

