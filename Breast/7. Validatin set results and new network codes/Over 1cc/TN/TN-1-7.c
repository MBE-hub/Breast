//Analysis Type - Classification 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double TN_1_7_MLP_22_13_2_input_hidden_weights[13][22]=
{
 {7.85906437167495e-002, 8.57846657395271e-002, 1.60667971225924e-001, 1.66950509158820e-001, 4.00059065621794e-002, 1.41741827165205e-001, 1.44256160692503e-001, 2.15077879005279e-001, 6.63130652262773e-002, 1.65613230928984e-001, -3.34035238709088e-003, 5.61151123433914e-002, 1.92773265936483e-001, 6.31619691468369e-002, 6.67244441366342e-002, -8.21722090168806e-002, 1.35201206216874e-001, 2.70107569016542e-002, -2.23136269871000e-002, 1.89746653791982e-001, 1.01391172964893e-001, 1.20950249300401e-001 },
 {1.38465513037332e-001, 2.58266325271631e-001, -1.27680709365243e-002, -6.78599043492150e-002, 4.41352073529958e-001, 1.58835123655240e-002, -1.70605515624287e-001, -1.48541526333309e-001, -1.15881539282232e-002, -4.04060519839534e-001, 1.54950796265673e-001, -4.17518390746224e-002, 5.63669051570522e-002, -1.14254111490538e-001, 2.07104061383154e-001, 4.98628751834204e-001, 3.93595760844202e-002, 1.72588315485156e-001, 1.30044032615252e-001, -3.21149769440166e-001, -1.32185209917621e-001, -2.19692037597697e-001 },
 {4.44471029762207e-002, 7.54081402736343e-002, 3.82292507361975e-002, 6.05233900859247e-002, 5.82794209721591e-002, 1.40794519226821e-002, 1.23095918677832e-001, -5.50452175840174e-002, -7.65647043599721e-002, 3.45111890640667e-002, 2.56913239919702e-001, 3.11979076430988e-001, 1.08698058968903e-001, 2.16642582655207e-001, -1.75170151288265e-001, 1.99034845137786e-001, -5.22449257432856e-002, 7.83836884678570e-002, 3.84274931402178e-001, -7.22153388596277e-002, 2.14327344539770e-001, -1.42693295106030e-001 },
 {6.57244346460666e-001, -1.49077112963441e-002, -2.56025838826438e-001, -7.36539149131393e-003, 4.41680877969576e-001, -4.12483160730408e-001, -6.16833503997311e-001, -5.15818815525574e-001, -5.40505763761986e-001, -1.02936891572747e+000, 2.32770482942334e-001, -9.10844017496463e-002, -1.44220605983682e-001, -1.65720782162910e-001, -2.13710983793150e-001, 5.45397510549415e-001, -4.02771953360614e-001, 2.89133564522948e-001, 4.08184572670147e-001, -1.17859562110757e+000, 3.39579201774692e-001, -8.32543960386429e-001 },
 {-5.22364542403920e-002, -1.00501400803508e-001, 2.62539612335768e-002, 1.37553922758236e-001, -2.23807843206721e-001, -1.86976967079228e-002, 2.87726502461438e-001, -1.48357762135274e-001, -1.75871236286289e-001, 2.13536613648422e-001, 3.23371545061860e-001, 5.59752942556335e-001, 1.32973894669762e-001, 4.05399828441401e-001, -5.26982707085442e-001, -7.10478507117394e-002, -2.19692183571165e-001, -8.59112861890070e-002, 5.71498065911826e-001, -1.27204414328232e-001, 5.01350705102989e-001, -2.85550292480519e-001 },
 {-4.43314437740645e-001, -5.31427438941657e-001, -7.07818777878669e-003, 8.85912933161254e-002, -9.36897974533370e-001, 2.56920445352463e-002, 6.63146158814865e-001, -6.85022851697931e-002, -4.09156885790943e-001, 8.00863900375896e-001, 1.56058515564662e-001, 8.04221065736606e-001, 6.00352929534492e-003, 6.50350132422068e-001, -1.18332497598167e+000, -8.42744529034913e-001, -5.26442519596497e-001, -5.16806630185465e-001, 6.13349401286782e-001, 1.29110987428588e-001, 8.87118940309642e-001, -3.43228551259607e-001 },
 {-1.74325845346053e+000, -1.17613094159461e+000, -2.83140142759924e-001, -6.42320228630113e-001, -2.16120717182117e+000, 2.76915954087468e-001, 1.36196615659135e+000, -1.41165048568945e-001, -3.06022964373137e-001, 1.71408430468571e+000, 3.31651480919785e-001, 1.76208095643506e+000, -1.88270589705743e-001, 1.29283129873180e+000, -1.80851050840315e+000, -1.38453019699507e+000, -1.13217450856658e+000, -5.72146761020130e-001, 1.11726431987397e+000, 4.44995681049291e-001, 7.94181216276535e-001, -3.29510119779062e-001 },
 {-8.05926424703672e-002, -6.94801638431915e-002, 9.96570504284504e-002, 1.19034807756371e-001, -2.52513219856349e-001, 8.17633386981892e-002, 2.92529706672653e-001, 1.08534256527054e-002, -1.35880994657842e-001, 3.78846165599491e-001, 1.41538827121791e-001, 3.82920975623724e-001, 7.73927065847419e-002, 2.77428498623309e-001, -4.52595544511332e-001, -2.76602867224235e-001, -1.46727364722867e-001, -1.47689058356669e-001, 2.64758377884973e-001, 7.27833027743929e-002, 3.84789080579303e-001, -1.86038594821371e-001 },
 {-2.39699818878231e-001, -3.57133546235310e-001, 4.03493922017835e-002, 1.14975172961210e-001, -7.46148652356580e-001, 1.63082315243136e-002, 5.18873276341645e-001, -4.40342014200762e-002, -3.17977557587915e-001, 6.22652998572609e-001, 1.92569244653422e-001, 6.87428869717370e-001, 6.46419457678316e-002, 5.67713980302992e-001, -9.93810006581400e-001, -6.28293330478186e-001, -4.00091404122942e-001, -3.82852581415813e-001, 5.54930305338644e-001, 7.97636963230417e-002, 8.11310349676378e-001, -2.71602401291061e-001 },
 {-5.12823307662202e-001, -6.12097918734095e-001, 1.15362179312055e-002, 8.04008542908194e-002, -1.06766670615376e+000, -9.46547526287682e-003, 6.95382091950833e-001, -1.03785132090969e-001, -4.21899954352279e-001, 8.62286384859956e-001, 1.67905854591461e-001, 8.97583681463386e-001, 2.67096894451744e-002, 7.01987599110256e-001, -1.25498729498352e+000, -9.22369967935877e-001, -5.53476692344815e-001, -5.44760707000048e-001, 6.07302054178593e-001, 1.65020732248128e-001, 9.81784021174571e-001, -3.31013157846775e-001 },
 {5.32510480499595e-002, 1.43717002584024e-001, 5.75191829548089e-003, 8.89446390534863e-002, 1.61504618036574e-001, 9.95384430266151e-005, 7.79201802550748e-002, -1.26247289582224e-001, -4.85748988921240e-002, -8.79339459721310e-002, 2.74280476704141e-001, 2.67725094932492e-001, 1.25337160976590e-001, 1.83312861303534e-001, -1.04226680590361e-001, 2.66126106837736e-001, -6.37476849635980e-002, 1.45329643560603e-001, 3.31047801247312e-001, -1.89627597690856e-001, 1.75888861771350e-001, -9.39326709570043e-002 },
 {2.93280966486399e-001, 4.55404758415421e-001, -2.65963876340760e-002, 6.24934615712021e-002, 9.36927883440611e-001, -1.25345062089598e-001, -2.74406986416317e-001, -2.82362526718603e-001, 6.90642382479072e-002, -9.12340931491561e-001, 3.08916026556711e-001, -1.09412443523620e-001, 2.92059270615907e-001, -2.17040329702755e-001, 4.88847051217862e-001, 9.59162010459834e-001, 2.23325402073909e-001, 4.51689865964288e-001, 2.56130164155932e-001, -6.13626842627761e-001, -5.39634451304767e-002, -2.40920412035101e-001 },
 {3.33680715453536e-001, 1.24672121935053e-003, -2.18424479998373e-001, -3.33307561627458e-002, 2.93202220150152e-001, -3.22590063139957e-001, -4.07538090229785e-001, -4.43069426147268e-001, -4.28346686273661e-001, -7.65103756935709e-001, 2.25207302481158e-001, -1.34026709197415e-002, -1.16663526670437e-001, -1.32889255882800e-001, -2.24226453738479e-001, 4.27778836099726e-001, -2.86441983050370e-001, 1.57075228330973e-001, 3.47964613983833e-001, -8.97029255748877e-001, 2.68591653758554e-001, -6.63457410951002e-001 } 
};

double TN_1_7_MLP_22_13_2_hidden_bias[13]={ 2.41251825127840e-001, -1.11088888833573e-001, -6.43641655976478e-002, -4.75259043797281e-001, -1.18911076380908e-001, -1.60584460123064e-001, -7.28496904554908e-001, 7.46238217289707e-002, -1.01942225976817e-001, -1.44713680965715e-001, -5.81702715809542e-002, -1.35957173226870e-001, -4.43144868541864e-001 };

double TN_1_7_MLP_22_13_2_hidden_output_wts[2][13]=
{
 {-4.98175596777071e-002, 7.54813190489580e-001, 1.52732007784366e-001, 1.92210993285029e+000, -1.74206414432269e-001, -1.05739657615985e+000, -1.72983394509530e+000, -3.42964719924013e-001, -8.67994004559441e-001, -1.15045850250112e+000, 2.57437151423197e-001, 1.45253840171007e+000, 1.35686074371920e+000 },
 {2.51449925501747e-001, -9.64148284431122e-001, -4.24928917196250e-001, -3.04267712512774e+000, -1.73646365909525e-001, 1.94736208422120e-001, 2.25142319747946e+000, -8.23022154220476e-002, 1.34729134451821e-001, 2.83398512211194e-001, -5.50157445271526e-001, -1.48020502181343e+000, -2.05500023854243e+000 }
};

double TN_1_7_MLP_22_13_2_output_bias[2]={ 1.21046036783436e+000, 2.44809582034357e+000 };

double TN_1_7_MLP_22_13_2_max_input[22]={ 9.98205853844333e-001, 9.98278127930000e-001, 9.97102711270667e-001, 9.99979798185333e-001, 9.85907962998000e-001, 9.76060123067333e-001, 9.69573341435000e-001, 9.88361539433000e-001, 9.67474315403000e-001, 6.77785077092000e+000, 8.16193723420333e+000, 6.46031687483333e+000, 9.99316191677333e-001, 6.07940450162667e+000, 9.57964581975667e-001, 6.71294571244000e+000, 9.99999999999667e-001, 5.17577777731667e+000, 7.02255299145000e+000, 8.60739480852333e-001, 8.17330004459667e-001, 9.99712242127000e-001 };

double TN_1_7_MLP_22_13_2_min_input[22]={ 9.52721802638333e-001, 8.93705061552667e-001, 9.17629414271333e-001, 8.14424454238667e-001, 8.06267137025000e-001, 8.60101696074000e-001, 8.12308146372000e-001, 8.30485571062667e-001, 7.30127857169000e-001, 4.60643372615000e+000, 5.30000733675333e+000, 4.01210318245333e+000, 6.59873139234333e-001, 3.25406740473667e+000, 6.07910368052667e-001, 3.78874837243333e+000, 6.17261118161667e-001, 3.03813268853333e+000, 3.45214241290333e+000, 2.33669934136333e-001, 3.12766281606667e-001, 5.40999113597333e-001 };

double TN_1_7_MLP_22_13_2_input[22];
double TN_1_7_MLP_22_13_2_hidden[13];
double TN_1_7_MLP_22_13_2_output[2];

double TN_1_7_MLP_22_13_2_MeanInputs[22]={ 9.80044802295625e-001, 9.77491341848946e-001, 9.72327345698061e-001, 9.92932614739722e-001, 9.45962721264683e-001, 9.22808703059702e-001, 9.23331561691087e-001, 9.45256645895686e-001, 8.71327342031888e-001, 5.83507039367946e+000, 6.66331154121907e+000, 5.10522097299981e+000, 9.14673531002154e-001, 4.86726459960263e+000, 7.70510779316625e-001, 5.50287463832869e+000, 8.93670683957503e-001, 4.15130051789327e+000, 5.21216796607840e+000, 6.47802369883849e-001, 6.60728465309429e-001, 8.45001887949218e-001 };

void TN_1_7_MLP_22_13_2_ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(TN_1_7_MLP_22_13_2_max_input[i]-TN_1_7_MLP_22_13_2_min_input[i]);
	input[i] = minimum - delta*TN_1_7_MLP_22_13_2_min_input[i]+ delta*input[i];
 }
}

double TN_1_7_MLP_22_13_2_logistic(double x)
{
  if(x > 100.0) x = 1.0;
  else if (x < -100.0) x = 0.0;
  else x = 1.0/(1.0+exp(-x));
  return x;
}

void TN_1_7_MLP_22_13_2_Normalise(double out[],long length)
{
  long i, j;
  double sum = 0.0;
  for(i=0; i<length; i++)
  {
   if(out[i]>100)
   {
    out[i] = 1.0;
    j = i;
    for(i=0; i<length; i++)
    {
     if(i!=j) out[i] = 0.0;
    }
    break;
   }
   else out[i] = exp(out[i]);
  }
  for(i=0; i<length; i++)
  {
   sum += out[i];
  }
  for(i=0; i<length; i++)
  {
   out[i] = out[i]/sum;
  }
}

void TN_1_7_MLP_22_13_2_ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = TN_1_7_MLP_22_13_2_logistic(V_OUT[row]);
      if(layer==1) V_OUT[row] = tanh(V_OUT[row]);
   }
}

void TN_1_7_MLP_22_13_2_RunNeuralNet_Classification () 
{
  TN_1_7_MLP_22_13_2_ComputeFeedForwardSignals((double*)TN_1_7_MLP_22_13_2_input_hidden_weights,TN_1_7_MLP_22_13_2_input,TN_1_7_MLP_22_13_2_hidden,TN_1_7_MLP_22_13_2_hidden_bias,22, 13,0);
  TN_1_7_MLP_22_13_2_ComputeFeedForwardSignals((double*)TN_1_7_MLP_22_13_2_hidden_output_wts,TN_1_7_MLP_22_13_2_hidden,TN_1_7_MLP_22_13_2_output,TN_1_7_MLP_22_13_2_output_bias,13, 2,1);
}

int main()
{
  int cont_inps;
  int index;
  int i=0;
  int keyin=1;
  double max;
  while(1)
  {
	max=3.e-300;
	printf("\n%s\n","Enter values for Continuous inputs (To skip a continuous input please enter -9999)");
	printf("%s","Cont. Input-0(wavelet-HLLglcmIdmn): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[0]);
	printf("%s","Cont. Input-1(wavelet-HHHglcmIdmn): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[1]);
	printf("%s","Cont. Input-2(wavelet-HLHglcmIdmn): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[2]);
	printf("%s","Cont. Input-3(wavelet-LLHglcmImc2): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[3]);
	printf("%s","Cont. Input-4(wavelet-LHHglrlmShortRunEmphasis): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[4]);
	printf("%s","Cont. Input-5(wavelet-HHLglcmIdn): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[5]);
	printf("%s","Cont. Input-6(originalglrlmRunLengthNonUniformityNormalized): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[6]);
	printf("%s","Cont. Input-7(wavelet-LLHglcmIdmn): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[7]);
	printf("%s","Cont. Input-8(wavelet-LLHglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[8]);
	printf("%s","Cont. Input-9(wavelet-LHLgldmDependenceEntropy): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[9]);
	printf("%s","Cont. Input-10(wavelet-LLLglszmZoneEntropy): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[10]);
	printf("%s","Cont. Input-11(originalglrlmRunEntropy): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[11]);
	printf("%s","Cont. Input-12(wavelet-LLLglcmMCC): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[12]);
	printf("%s","Cont. Input-13(wavelet-LLLglcmDifferenceEntropy): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[13]);
	printf("%s","Cont. Input-14(wavelet-HHLglrlmRunPercentage): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[14]);
	printf("%s","Cont. Input-15(wavelet-HLHglszmZoneEntropy): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[15]);
	printf("%s","Cont. Input-16(wavelet-LLHglcmMCC): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[16]);
	printf("%s","Cont. Input-17(wavelet-LHHglrlmRunEntropy): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[17]);
	printf("%s","Cont. Input-18(originalglcmSumEntropy): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[18]);
	printf("%s","Cont. Input-19(wavelet-LHLglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[19]);
	printf("%s","Cont. Input-20(originalshapeSphericity): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[20]);
	printf("%s","Cont. Input-21(wavelet-HLHglcmImc2): ");
	scanf("%lg",&TN_1_7_MLP_22_13_2_input[21]);
	for(cont_inps=0;cont_inps<22;cont_inps++)
	{
     //Substitution of missing continuous variables
     if(TN_1_7_MLP_22_13_2_input[cont_inps] == -9999)
	  TN_1_7_MLP_22_13_2_input[cont_inps]=TN_1_7_MLP_22_13_2_MeanInputs[cont_inps];
	}
    TN_1_7_MLP_22_13_2_ScaleInputs(TN_1_7_MLP_22_13_2_input,0,1,22);
	TN_1_7_MLP_22_13_2_RunNeuralNet_Classification();
   //Normalise output if output activation is not Softmax;
 	TN_1_7_MLP_22_13_2_Normalise(TN_1_7_MLP_22_13_2_output,2);
	for(i=0;i<2;i++)
	{
      if(max<TN_1_7_MLP_22_13_2_output[i])
      {
        max=TN_1_7_MLP_22_13_2_output[i];
        index=i+1;
      }
	}
	printf("\n%s","Predicted category = ");

    switch(index)
    {
        case 1: printf("%s\n","0"); break;
        case 2: printf("%s\n","1"); break;
        default: break;
    }
    printf("\n%s%.14f","Confidence level = ",max);
	printf("\n\n%s\n","Press any key to make another prediction or enter 0 to quit the program.");
	keyin=getch();
	if(keyin==48)break;
  }
	return 0;
}

