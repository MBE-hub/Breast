//Analysis Type - Classification 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double TN_1_1_MLP_22_9_2_input_hidden_weights[9][22]=
{
 {-1.89302679491492e-002, -4.69259852492634e-002, 3.22760001250126e-002, 4.41879067453721e-002, -3.16200473218312e-002, -3.25897267164360e-003, 8.79068219014097e-003, 1.35786696700882e-002, 1.17563398696149e-003, 5.02228123941118e-002, -2.47016874829988e-002, 5.42769051917587e-002, 2.12636175207146e-002, 3.75152440100016e-002, -5.70652252244928e-003, -1.11965485336170e-002, 2.73817002295257e-002, -2.83303944420840e-002, -1.17191421160192e-002, 1.03103983426935e-002, 1.92017338612215e-002, -9.02712429514127e-003 },
 {-1.46677308011294e-003, -1.26319278233845e-002, -4.04363562290911e-003, -4.84983859968284e-002, 8.20414290129057e-004, -1.13599956981185e-002, 1.39610138677680e-002, -1.01074513826821e-002, 1.37064603017069e-002, -4.72118059000152e-002, -4.15612395387528e-003, -1.86758477786185e-002, 2.83322464491606e-003, -3.16603947609598e-002, -3.39452259633824e-003, -3.64107622871434e-003, -1.88409249533023e-002, -1.08970628212819e-004, 5.13187835458131e-002, -2.63057536897196e-002, -3.94565038632423e-003, -1.04662531103080e-002 },
 {3.14147897928090e-002, 1.59110675046818e-002, 2.43714512411390e-002, 4.03235302132534e-002, 2.42566789083369e-003, 3.25967309794341e-002, 4.77183555750483e-002, 1.23686142969210e-002, -4.47511400189411e-003, 4.19988166723115e-002, 4.23112783384665e-002, 1.57858717038594e-002, 5.07433001145666e-002, 3.71038165950301e-002, 5.43678686938213e-002, 1.65325434636181e-002, -5.89005242766632e-003, 4.19137569048523e-002, 1.21255135449500e-002, 5.70710971132182e-002, 2.51569499958020e-004, -3.36962169060059e-002 },
 {4.40223984385559e-002, -7.68379130024766e-003, 3.19186433365431e-002, -2.17381164801086e-002, 4.47330368294289e-003, -2.36069280248698e-002, -2.99817473465013e-003, 1.97672589397901e-002, 1.37646459324128e-002, 7.91000267797828e-003, -2.94859354138392e-002, 1.26560293673140e-004, -1.51535011326232e-002, 4.20244324178369e-003, -1.60205099235466e-002, -3.55876319114375e-002, 9.38957074270107e-003, 9.78636901821080e-003, 2.07286902569054e-002, -2.61830182217035e-002, 2.84788912851978e-003, -1.46964590071747e-002 },
 {3.44962334871134e-002, 2.63805174042250e-003, -3.15828758217275e-002, 3.38828817921991e-002, 8.42241248611980e-003, -1.95136199693851e-002, 9.37729663328872e-003, 1.09905254372742e-002, 5.42897437583871e-003, 3.64994511542069e-002, 8.83297806291296e-003, 1.12757350963288e-003, 2.87812609970038e-002, -1.55252668497911e-002, 1.20446891969691e-002, 2.24339916992474e-002, 3.15420006367677e-002, 1.43423215458740e-002, 3.81422119564715e-002, -4.86131581349590e-003, 2.40261573963633e-002, 1.08867807199482e-002 },
 {-1.14054404411221e-002, -5.97603608192703e-002, -1.08689725899434e-003, -1.25217921760578e-002, -4.39816358461195e-002, 2.11794685228823e-002, -4.34476131283634e-002, -6.38552815126528e-004, -3.61039055932393e-003, -3.57125766900964e-002, -2.35986660570160e-002, 1.61854452293160e-002, 7.11150091109601e-003, 2.46427893274610e-003, -2.57728126920639e-003, 1.87414252251472e-002, -2.71497364765965e-002, -1.73318772173520e-002, -1.00679153797632e-002, 4.45637746966689e-003, -1.54015692894484e-002, -2.17839638675825e-002 },
 {3.89563681264042e-002, -1.51560641399312e-002, 4.29722524277555e-003, -1.75247533625483e-003, -4.09219660849698e-003, 3.21405072713341e-002, 7.39955336299630e-003, -8.31052350755684e-003, -1.21727182727629e-002, 2.40213227780249e-002, -4.34588861906975e-003, -1.80483305540769e-002, 2.73072315878692e-002, 3.18607022020878e-002, 3.51831219572172e-002, -1.07981488591576e-002, 1.06109213290239e-002, 3.09912047073619e-002, 8.08006681774260e-003, 7.36993279867135e-003, -4.26772704803774e-003, 2.26096733686717e-002 },
 {6.44265741422583e-003, 4.97017574807268e-002, 2.75205855616036e-002, -4.80480143816700e-003, -5.63172845180913e-002, -1.67211383171998e-003, 7.40714169845768e-003, 1.44518806599980e-002, 1.48647595805881e-002, 3.62930059227875e-003, 1.42991971250327e-002, 1.28384456213135e-002, 9.21759744829991e-003, 1.91345588835183e-002, -4.20933183664980e-003, 2.28472100228819e-004, -2.18967235883011e-002, 1.64833926943036e-002, 3.65055067829580e-002, -8.12339187378982e-003, -3.06813395774045e-002, -1.25537956135392e-002 },
 {5.67656013514098e-003, -4.11409708644480e-002, 6.12863866935590e-003, 2.21833120761828e-002, -2.67374102206722e-002, -3.88270508110750e-002, -3.23841989383649e-002, 3.21232896496141e-002, -2.86510220382379e-002, -2.70920821339542e-002, 3.39624720953751e-002, 4.85223442925386e-003, 5.94518658158817e-002, -6.53994546933711e-003, -2.22007262166157e-002, -1.52692239920514e-002, -1.18441485355117e-002, 1.44935279914563e-002, 2.81937765788584e-003, -5.06529132003200e-002, -3.11530653260692e-002, 7.99586809019921e-003 } 
};

double TN_1_1_MLP_22_9_2_hidden_bias[9]={ -2.24979969820776e-002, -4.64372875870907e-002, 6.59396346681072e-002, 6.58691531519675e-002, 2.90609937249495e-002, 8.13874839061082e-003, -2.28028384716487e-002, 2.61062187619323e-002, -3.66144151818873e-003 };

double TN_1_1_MLP_22_9_2_hidden_output_wts[2][9]=
{
 {-1.27846045137279e-002, -1.22045353146082e-001, 1.50979558862629e-001, 1.24093538154323e-002, 7.26218919839723e-002, -1.01297789521377e-001, -7.76972087107010e-002, 1.05722335545150e-002, -2.91102576742513e-002 },
 {1.52358474806063e-003, -2.63052681355658e-002, 1.45812917557027e-002, 7.59279142390964e-003, 5.65773363443122e-002, 4.05005753536952e-003, -7.09879770298750e-002, 4.71832934812025e-002, -1.92191672858786e-002 }
};

double TN_1_1_MLP_22_9_2_output_bias[2]={ 8.16980869347676e-001, 5.38367735202412e-002 };

double TN_1_1_MLP_22_9_2_max_input[22]={ 9.98205853844333e-001, 9.98278127930000e-001, 9.97102711270667e-001, 9.99979798185333e-001, 9.85907962998000e-001, 9.76060123067333e-001, 9.69573341435000e-001, 9.88361539433000e-001, 9.67474315403000e-001, 6.77785077092000e+000, 8.16193723420333e+000, 6.46031687483333e+000, 9.99316191677333e-001, 6.07940450162667e+000, 9.57964581975667e-001, 6.71294571244000e+000, 9.99999999999667e-001, 5.17577777731667e+000, 7.02255299145000e+000, 8.60739480852333e-001, 8.17330004459667e-001, 9.99712242127000e-001 };

double TN_1_1_MLP_22_9_2_min_input[22]={ 9.52721802638333e-001, 8.93705061552667e-001, 9.17629414271333e-001, 8.14424454238667e-001, 8.06267137025000e-001, 8.60101696074000e-001, 8.12308146372000e-001, 8.30485571062667e-001, 7.30127857169000e-001, 4.60643372615000e+000, 5.30000733675333e+000, 4.01210318245333e+000, 6.59873139234333e-001, 3.25406740473667e+000, 6.07910368052667e-001, 3.78874837243333e+000, 6.17261118161667e-001, 3.03813268853333e+000, 3.45214241290333e+000, 2.33669934136333e-001, 3.12766281606667e-001, 5.40999113597333e-001 };

double TN_1_1_MLP_22_9_2_input[22];
double TN_1_1_MLP_22_9_2_hidden[9];
double TN_1_1_MLP_22_9_2_output[2];

double TN_1_1_MLP_22_9_2_MeanInputs[22]={ 9.80044802295625e-001, 9.77491341848946e-001, 9.72327345698061e-001, 9.92932614739722e-001, 9.45962721264683e-001, 9.22808703059702e-001, 9.23331561691087e-001, 9.45256645895686e-001, 8.71327342031888e-001, 5.83507039367946e+000, 6.66331154121907e+000, 5.10522097299981e+000, 9.14673531002154e-001, 4.86726459960263e+000, 7.70510779316625e-001, 5.50287463832869e+000, 8.93670683957503e-001, 4.15130051789327e+000, 5.21216796607840e+000, 6.47802369883849e-001, 6.60728465309429e-001, 8.45001887949218e-001 };

void TN_1_1_MLP_22_9_2_ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(TN_1_1_MLP_22_9_2_max_input[i]-TN_1_1_MLP_22_9_2_min_input[i]);
	input[i] = minimum - delta*TN_1_1_MLP_22_9_2_min_input[i]+ delta*input[i];
 }
}

void TN_1_1_MLP_22_9_2_Normalise(double out[],long length)
{
  long i, j;
  double sum = 0.0;
  for(i=0; i<length; i++)
  {
   if(out[i]>100)
   {
    out[i] = 1.0;
    j = i;
    for(i=0; i<length; i++)
    {
     if(i!=j) out[i] = 0.0;
    }
    break;
   }
   else out[i] = exp(out[i]);
  }
  for(i=0; i<length; i++)
  {
   sum += out[i];
  }
  for(i=0; i<length; i++)
  {
   out[i] = out[i]/sum;
  }
}

void TN_1_1_MLP_22_9_2_ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = tanh(V_OUT[row]);
   }
}

void TN_1_1_MLP_22_9_2_RunNeuralNet_Classification () 
{
  TN_1_1_MLP_22_9_2_ComputeFeedForwardSignals((double*)TN_1_1_MLP_22_9_2_input_hidden_weights,TN_1_1_MLP_22_9_2_input,TN_1_1_MLP_22_9_2_hidden,TN_1_1_MLP_22_9_2_hidden_bias,22, 9,0);
  TN_1_1_MLP_22_9_2_ComputeFeedForwardSignals((double*)TN_1_1_MLP_22_9_2_hidden_output_wts,TN_1_1_MLP_22_9_2_hidden,TN_1_1_MLP_22_9_2_output,TN_1_1_MLP_22_9_2_output_bias,9, 2,1);
}

int main()
{
  int cont_inps;
  int index;
  int i=0;
  int keyin=1;
  double max;
  while(1)
  {
	max=3.e-300;
	printf("\n%s\n","Enter values for Continuous inputs (To skip a continuous input please enter -9999)");
	printf("%s","Cont. Input-0(wavelet-HLLglcmIdmn): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[0]);
	printf("%s","Cont. Input-1(wavelet-HHHglcmIdmn): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[1]);
	printf("%s","Cont. Input-2(wavelet-HLHglcmIdmn): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[2]);
	printf("%s","Cont. Input-3(wavelet-LLHglcmImc2): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[3]);
	printf("%s","Cont. Input-4(wavelet-LHHglrlmShortRunEmphasis): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[4]);
	printf("%s","Cont. Input-5(wavelet-HHLglcmIdn): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[5]);
	printf("%s","Cont. Input-6(originalglrlmRunLengthNonUniformityNormalized): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[6]);
	printf("%s","Cont. Input-7(wavelet-LLHglcmIdmn): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[7]);
	printf("%s","Cont. Input-8(wavelet-LLHglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[8]);
	printf("%s","Cont. Input-9(wavelet-LHLgldmDependenceEntropy): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[9]);
	printf("%s","Cont. Input-10(wavelet-LLLglszmZoneEntropy): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[10]);
	printf("%s","Cont. Input-11(originalglrlmRunEntropy): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[11]);
	printf("%s","Cont. Input-12(wavelet-LLLglcmMCC): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[12]);
	printf("%s","Cont. Input-13(wavelet-LLLglcmDifferenceEntropy): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[13]);
	printf("%s","Cont. Input-14(wavelet-HHLglrlmRunPercentage): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[14]);
	printf("%s","Cont. Input-15(wavelet-HLHglszmZoneEntropy): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[15]);
	printf("%s","Cont. Input-16(wavelet-LLHglcmMCC): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[16]);
	printf("%s","Cont. Input-17(wavelet-LHHglrlmRunEntropy): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[17]);
	printf("%s","Cont. Input-18(originalglcmSumEntropy): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[18]);
	printf("%s","Cont. Input-19(wavelet-LHLglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[19]);
	printf("%s","Cont. Input-20(originalshapeSphericity): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[20]);
	printf("%s","Cont. Input-21(wavelet-HLHglcmImc2): ");
	scanf("%lg",&TN_1_1_MLP_22_9_2_input[21]);
	for(cont_inps=0;cont_inps<22;cont_inps++)
	{
     //Substitution of missing continuous variables
     if(TN_1_1_MLP_22_9_2_input[cont_inps] == -9999)
	  TN_1_1_MLP_22_9_2_input[cont_inps]=TN_1_1_MLP_22_9_2_MeanInputs[cont_inps];
	}
    TN_1_1_MLP_22_9_2_ScaleInputs(TN_1_1_MLP_22_9_2_input,0,1,22);
	TN_1_1_MLP_22_9_2_RunNeuralNet_Classification();
   //Normalise output if output activation is not Softmax;
 	TN_1_1_MLP_22_9_2_Normalise(TN_1_1_MLP_22_9_2_output,2);
	for(i=0;i<2;i++)
	{
      if(max<TN_1_1_MLP_22_9_2_output[i])
      {
        max=TN_1_1_MLP_22_9_2_output[i];
        index=i+1;
      }
	}
	printf("\n%s","Predicted category = ");

    switch(index)
    {
        case 1: printf("%s\n","0"); break;
        case 2: printf("%s\n","1"); break;
        default: break;
    }
    printf("\n%s%.14f","Confidence level = ",max);
	printf("\n\n%s\n","Press any key to make another prediction or enter 0 to quit the program.");
	keyin=getch();
	if(keyin==48)break;
  }
	return 0;
}

