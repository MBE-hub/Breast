//Analysis Type - Classification 
#include <stdio.h>
#include <conio.h>
#include <math.h>
#include <stdlib.h>


double TN_1_3_MLP_22_12_2_input_hidden_weights[12][22]=
{
 {3.53190407545366e+000, 2.34814363424227e+000, 1.14431354791190e+000, 3.95479731426147e-001, 3.79063592641293e+000, -2.00032991284372e-001, -3.20866424768597e+000, 2.15324135447524e+000, 6.65754508798124e-001, -2.86613267134268e+000, -8.87031985758922e-001, -4.50044075652661e+000, -1.75801458401279e-001, -3.63261540757244e+000, 4.81869205514095e+000, 2.41552959798371e+000, 1.99515148285510e+000, 1.35219550073024e+000, -3.36678224294621e+000, -2.55563393578947e-001, -3.06034902981774e+000, 7.42225336906639e-001 },
 {2.74651828646595e+000, 1.94455545026052e+000, 7.87683037017731e-001, 2.29981408239967e-001, 3.33580625202356e+000, -2.57228763255915e-001, -2.72458396221051e+000, 1.59992898293977e+000, 8.76354677062869e-001, -2.71860588158066e+000, -9.85091798990738e-001, -3.98855112324421e+000, -1.27705286389314e-001, -3.22451063089951e+000, 4.44843015991740e+000, 2.19565087849302e+000, 1.99530396791317e+000, 1.22686965821130e+000, -3.07861187026673e+000, -2.77109155987447e-001, -2.85025863133493e+000, 1.00744631822512e+000 },
 {3.19059879422241e+000, 2.19987219348493e+000, 9.60901496781211e-001, 3.45519059390046e-001, 3.71430734780243e+000, -2.24021356636829e-001, -3.01457144804071e+000, 1.96233097494756e+000, 8.70180978893536e-001, -2.89412547810480e+000, -9.68485060165308e-001, -4.40576410420842e+000, -1.02038151419294e-001, -3.52621416284150e+000, 4.81076420698973e+000, 2.39476514125254e+000, 2.10627034649289e+000, 1.31610489207400e+000, -3.34475019344051e+000, -2.73578533562322e-001, -3.06980186106772e+000, 9.67039962046581e-001 },
 {1.33668212649048e+000, 1.86840458801161e+000, 4.28491591949448e-002, -3.46285067293548e-001, 3.52776248598830e+000, -1.54020917916971e-001, -2.28086684898270e+000, 6.11803426031633e-001, 1.73032775492647e+000, -2.85382100578635e+000, -1.21751563400845e+000, -3.56944436124949e+000, -6.15723696224786e-002, -2.89290862365871e+000, 4.76914442203581e+000, 2.55573125174414e+000, 2.27253796529528e+000, 1.62098492803624e+000, -2.94877364568730e+000, -3.93398443023150e-002, -3.53949084369275e+000, 1.68722645684451e+000 },
 {1.76048450763692e+000, 1.73746934966413e+000, 3.00014686639777e-001, -2.50747879719940e-001, 3.07644095755691e+000, -9.67933812756015e-002, -2.39654533216079e+000, 8.81740402777692e-001, 1.13641312328093e+000, -2.53745319237399e+000, -1.00873799681892e+000, -3.39892822431722e+000, -2.46585741575272e-001, -2.82068890890406e+000, 4.12618715789523e+000, 2.17782244376741e+000, 1.75402504420735e+000, 1.27504540940474e+000, -2.72644022907245e+000, -1.60774484077178e-001, -3.10061549508595e+000, 1.05612401332974e+000 },
 {3.39363362873801e+000, 2.14559736052252e+000, 8.69197429935941e-001, 3.24251475813521e-002, 3.71022929737554e+000, -4.74942852726768e-001, -3.65450267573726e+000, 1.95713792068977e+000, 5.22535909877918e-001, -3.27744737723421e+000, -1.14863072394586e+000, -4.92400794936763e+000, -5.55859273875529e-001, -4.06577207728505e+000, 4.88551297080760e+000, 2.26566649298590e+000, 1.88500531441691e+000, 1.23818693024875e+000, -3.72523676890119e+000, -5.40216036021431e-001, -3.54445644473393e+000, 4.93950154808678e-001 },
 {3.10823627777924e+000, 2.09153525161688e+000, 8.90698018471658e-001, 3.23324890523056e-001, 3.66407640747122e+000, -2.67178754813260e-001, -2.96536346038631e+000, 1.83277477161385e+000, 8.84662103351949e-001, -2.91390005872975e+000, -1.04804571944826e+000, -4.35450528610973e+000, -5.82674781999657e-002, -3.48021918888971e+000, 4.79302941826310e+000, 2.35678999883982e+000, 2.15227824009397e+000, 1.26851922414155e+000, -3.32434994390522e+000, -3.05040734337586e-001, -3.06912130482133e+000, 9.93429501613175e-001 },
 {3.34027635452939e+000, 2.23664584490780e+000, 9.95753193617454e-001, 1.87556306021396e-001, 3.56338574373718e+000, -2.38513791809643e-001, -3.28694918730032e+000, 1.95828529700776e+000, 5.59931536382130e-001, -2.85869089680715e+000, -9.25026970517113e-001, -4.48133344952975e+000, -3.28073675857251e-001, -3.62934394952141e+000, 4.64513438517101e+000, 2.29532878734072e+000, 1.74734656925987e+000, 1.25406027145691e+000, -3.40906699065491e+000, -3.59461232553805e-001, -3.16401038618912e+000, 5.93022307360455e-001 },
 {2.62498253762946e+000, 1.79886025166896e+000, 6.87326302850217e-001, 1.72698530849634e-001, 3.26230248050394e+000, -3.46709467600270e-001, -2.69429573577376e+000, 1.50685696403911e+000, 8.38129692865768e-001, -2.73851267477986e+000, -1.03207359970427e+000, -3.94669183133535e+000, -1.22391744247127e-001, -3.18905755966844e+000, 4.38170006985163e+000, 2.08242937425358e+000, 1.99270943122904e+000, 1.17434905326578e+000, -3.08565458990434e+000, -3.01189173642885e-001, -2.81597557590356e+000, 9.68101473713274e-001 },
 {3.13383823052506e+000, 2.26432187033362e+000, 9.27072960864192e-001, 4.10217915922228e-001, 3.96065859403299e+000, -2.32660841218162e-001, -2.97226527317253e+000, 1.87084693272049e+000, 1.11259923216455e+000, -3.03411716120488e+000, -1.03337287315968e+000, -4.45114066459121e+000, -5.05492630554382e-002, -3.57769665653283e+000, 5.13820787941507e+000, 2.55938925494690e+000, 2.34047036663766e+000, 1.50291575516969e+000, -3.40418461310034e+000, -2.56869610519117e-001, -3.30243085468148e+000, 1.11449285328728e+000 },
 {2.16796651435862e+000, 1.92831044086590e+000, 4.84741422776312e-001, -2.49188138781393e-002, 3.46233813647562e+000, -1.31720094286141e-001, -2.55823096869188e+000, 1.24267764211169e+000, 1.21396529217078e+000, -2.70676735150135e+000, -1.06102815857494e+000, -3.77925937799520e+000, -1.38394576977887e-001, -3.03655291238436e+000, 4.58161227821075e+000, 2.39488453839670e+000, 2.02319539648167e+000, 1.44671079971152e+000, -2.95821896573558e+000, -1.71332011808270e-001, -3.20970086162281e+000, 1.19085126632860e+000 },
 {8.36949883628299e-001, 1.63223963998791e+000, -1.74749519240515e-001, -1.87298681166887e-001, 3.28854742099739e+000, -2.47233231735722e-001, -1.84210155553839e+000, 3.20490601871920e-001, 1.80155043011733e+000, -2.61894543410771e+000, -1.28713821036109e+000, -3.18437420842208e+000, 1.94248990217833e-001, -2.52661194277297e+000, 4.66641943201429e+000, 2.30576722826563e+000, 2.38554823753665e+000, 1.52519511382178e+000, -2.73815397780736e+000, 9.57651797284932e-002, -3.13753564928062e+000, 1.97502151210525e+000 } 
};

double TN_1_3_MLP_22_12_2_hidden_bias[12]={ 2.48099473280102e+000, 1.94940731870228e+000, 2.29270568491534e+000, 9.31587833787436e-001, 1.04680282686563e+000, 2.15741068792805e+000, 2.17347761137729e+000, 2.19792038441669e+000, 1.89974518095373e+000, 2.24562598271292e+000, 1.53615261010632e+000, 7.61289008307185e-001 };

double TN_1_3_MLP_22_12_2_hidden_output_wts[2][12]=
{
 {1.75268615166689e+000, 7.39327132338903e-001, 1.33157104431020e+000, -8.97621469379318e-001, -3.52997119609795e-001, 1.73479991688316e+000, 1.19624042620955e+000, 1.54598862036553e+000, 7.03346277630341e-001, 1.11251602344373e+000, 1.20766741041070e-001, -8.78976338809092e-001 },
 {-2.59770799671158e+000, -2.22068684849716e+000, -2.52862274902571e+000, -1.56558761275713e+000, -1.97870338707052e+000, -2.26734957007295e+000, -2.58757397344637e+000, -3.06646599237000e+000, -2.38313684296282e+000, -2.15421185308185e+000, -2.08490832135189e+000, -1.15954914810859e+000 }
};

double TN_1_3_MLP_22_12_2_output_bias[2]={ -5.04529533837555e+000, 6.61316335526765e+000 };

double TN_1_3_MLP_22_12_2_max_input[22]={ 9.98205853844333e-001, 9.98278127930000e-001, 9.97102711270667e-001, 9.99979798185333e-001, 9.85907962998000e-001, 9.76060123067333e-001, 9.69573341435000e-001, 9.88361539433000e-001, 9.67474315403000e-001, 6.77785077092000e+000, 8.16193723420333e+000, 6.46031687483333e+000, 9.99316191677333e-001, 6.07940450162667e+000, 9.57964581975667e-001, 6.71294571244000e+000, 9.99999999999667e-001, 5.17577777731667e+000, 7.02255299145000e+000, 8.60739480852333e-001, 8.17330004459667e-001, 9.99712242127000e-001 };

double TN_1_3_MLP_22_12_2_min_input[22]={ 9.52721802638333e-001, 8.93705061552667e-001, 9.17629414271333e-001, 8.14424454238667e-001, 8.06267137025000e-001, 8.60101696074000e-001, 8.12308146372000e-001, 8.30485571062667e-001, 7.30127857169000e-001, 4.60643372615000e+000, 5.30000733675333e+000, 4.01210318245333e+000, 6.59873139234333e-001, 3.25406740473667e+000, 6.07910368052667e-001, 3.78874837243333e+000, 6.17261118161667e-001, 3.03813268853333e+000, 3.45214241290333e+000, 2.33669934136333e-001, 3.12766281606667e-001, 5.40999113597333e-001 };

double TN_1_3_MLP_22_12_2_input[22];
double TN_1_3_MLP_22_12_2_hidden[12];
double TN_1_3_MLP_22_12_2_output[2];

double TN_1_3_MLP_22_12_2_MeanInputs[22]={ 9.80044802295625e-001, 9.77491341848946e-001, 9.72327345698061e-001, 9.92932614739722e-001, 9.45962721264683e-001, 9.22808703059702e-001, 9.23331561691087e-001, 9.45256645895686e-001, 8.71327342031888e-001, 5.83507039367946e+000, 6.66331154121907e+000, 5.10522097299981e+000, 9.14673531002154e-001, 4.86726459960263e+000, 7.70510779316625e-001, 5.50287463832869e+000, 8.93670683957503e-001, 4.15130051789327e+000, 5.21216796607840e+000, 6.47802369883849e-001, 6.60728465309429e-001, 8.45001887949218e-001 };

void TN_1_3_MLP_22_12_2_ScaleInputs(double* input, double minimum, double maximum, int size)
{
 double delta;
 long i;
 for(i=0; i<size; i++)
 {
	delta = (maximum-minimum)/(TN_1_3_MLP_22_12_2_max_input[i]-TN_1_3_MLP_22_12_2_min_input[i]);
	input[i] = minimum - delta*TN_1_3_MLP_22_12_2_min_input[i]+ delta*input[i];
 }
}

double TN_1_3_MLP_22_12_2_logistic(double x)
{
  if(x > 100.0) x = 1.0;
  else if (x < -100.0) x = 0.0;
  else x = 1.0/(1.0+exp(-x));
  return x;
}

void TN_1_3_MLP_22_12_2_Normalise(double out[],long length)
{
  long i, j;
  double sum = 0.0;
  for(i=0; i<length; i++)
  {
   if(out[i]>100)
   {
    out[i] = 1.0;
    j = i;
    for(i=0; i<length; i++)
    {
     if(i!=j) out[i] = 0.0;
    }
    break;
   }
   else out[i] = exp(out[i]);
  }
  for(i=0; i<length; i++)
  {
   sum += out[i];
  }
  for(i=0; i<length; i++)
  {
   out[i] = out[i]/sum;
  }
}

void TN_1_3_MLP_22_12_2_ComputeFeedForwardSignals(double* MAT_INOUT,double* V_IN,double* V_OUT, double* V_BIAS,int size1,int size2,int layer)
{
  int row,col;
  for(row=0;row < size2; row++) 
    {
      V_OUT[row]=0.0;
      for(col=0;col<size1;col++)V_OUT[row]+=(*(MAT_INOUT+(row*size1)+col)*V_IN[col]);
      V_OUT[row]+=V_BIAS[row];
      if(layer==0) V_OUT[row] = TN_1_3_MLP_22_12_2_logistic(V_OUT[row]);
      if(layer==1) V_OUT[row] = TN_1_3_MLP_22_12_2_logistic(V_OUT[row]);
   }
}

void TN_1_3_MLP_22_12_2_RunNeuralNet_Classification () 
{
  TN_1_3_MLP_22_12_2_ComputeFeedForwardSignals((double*)TN_1_3_MLP_22_12_2_input_hidden_weights,TN_1_3_MLP_22_12_2_input,TN_1_3_MLP_22_12_2_hidden,TN_1_3_MLP_22_12_2_hidden_bias,22, 12,0);
  TN_1_3_MLP_22_12_2_ComputeFeedForwardSignals((double*)TN_1_3_MLP_22_12_2_hidden_output_wts,TN_1_3_MLP_22_12_2_hidden,TN_1_3_MLP_22_12_2_output,TN_1_3_MLP_22_12_2_output_bias,12, 2,1);
}

int main()
{
  int cont_inps;
  int index;
  int i=0;
  int keyin=1;
  double max;
  while(1)
  {
	max=3.e-300;
	printf("\n%s\n","Enter values for Continuous inputs (To skip a continuous input please enter -9999)");
	printf("%s","Cont. Input-0(wavelet-HLLglcmIdmn): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[0]);
	printf("%s","Cont. Input-1(wavelet-HHHglcmIdmn): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[1]);
	printf("%s","Cont. Input-2(wavelet-HLHglcmIdmn): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[2]);
	printf("%s","Cont. Input-3(wavelet-LLHglcmImc2): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[3]);
	printf("%s","Cont. Input-4(wavelet-LHHglrlmShortRunEmphasis): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[4]);
	printf("%s","Cont. Input-5(wavelet-HHLglcmIdn): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[5]);
	printf("%s","Cont. Input-6(originalglrlmRunLengthNonUniformityNormalized): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[6]);
	printf("%s","Cont. Input-7(wavelet-LLHglcmIdmn): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[7]);
	printf("%s","Cont. Input-8(wavelet-LLHglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[8]);
	printf("%s","Cont. Input-9(wavelet-LHLgldmDependenceEntropy): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[9]);
	printf("%s","Cont. Input-10(wavelet-LLLglszmZoneEntropy): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[10]);
	printf("%s","Cont. Input-11(originalglrlmRunEntropy): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[11]);
	printf("%s","Cont. Input-12(wavelet-LLLglcmMCC): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[12]);
	printf("%s","Cont. Input-13(wavelet-LLLglcmDifferenceEntropy): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[13]);
	printf("%s","Cont. Input-14(wavelet-HHLglrlmRunPercentage): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[14]);
	printf("%s","Cont. Input-15(wavelet-HLHglszmZoneEntropy): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[15]);
	printf("%s","Cont. Input-16(wavelet-LLHglcmMCC): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[16]);
	printf("%s","Cont. Input-17(wavelet-LHHglrlmRunEntropy): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[17]);
	printf("%s","Cont. Input-18(originalglcmSumEntropy): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[18]);
	printf("%s","Cont. Input-19(wavelet-LHLglszmSmallAreaEmphasis): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[19]);
	printf("%s","Cont. Input-20(originalshapeSphericity): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[20]);
	printf("%s","Cont. Input-21(wavelet-HLHglcmImc2): ");
	scanf("%lg",&TN_1_3_MLP_22_12_2_input[21]);
	for(cont_inps=0;cont_inps<22;cont_inps++)
	{
     //Substitution of missing continuous variables
     if(TN_1_3_MLP_22_12_2_input[cont_inps] == -9999)
	  TN_1_3_MLP_22_12_2_input[cont_inps]=TN_1_3_MLP_22_12_2_MeanInputs[cont_inps];
	}
    TN_1_3_MLP_22_12_2_ScaleInputs(TN_1_3_MLP_22_12_2_input,0,1,22);
	TN_1_3_MLP_22_12_2_RunNeuralNet_Classification();
   //Normalise output if output activation is not Softmax;
 	TN_1_3_MLP_22_12_2_Normalise(TN_1_3_MLP_22_12_2_output,2);
	for(i=0;i<2;i++)
	{
      if(max<TN_1_3_MLP_22_12_2_output[i])
      {
        max=TN_1_3_MLP_22_12_2_output[i];
        index=i+1;
      }
	}
	printf("\n%s","Predicted category = ");

    switch(index)
    {
        case 1: printf("%s\n","0"); break;
        case 2: printf("%s\n","1"); break;
        default: break;
    }
    printf("\n%s%.14f","Confidence level = ",max);
	printf("\n\n%s\n","Press any key to make another prediction or enter 0 to quit the program.");
	keyin=getch();
	if(keyin==48)break;
  }
	return 0;
}

